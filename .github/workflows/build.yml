name: Build Ultimate Hook

on: [push]

jobs:
  build:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: recursive
      
      - name: Setup Theos
        run: |
          git clone --recursive https://github.com/theos/theos.git $HOME/theos
          echo "THEOS=$HOME/theos" >> $GITHUB_ENV
      
      - name: Install ldid
        run: |
          brew install ldid
          
      - name: Build Tweak
        run: |
          # 1. å¼€å§‹ç¼–è¯‘
          make package FINALPACKAGE=1
          
          # 2. ğŸŸ¢ å…³é”®æ“ä½œï¼šæŠŠè—èµ·æ¥çš„ dylib æŠ“å‡ºæ¥ï¼
          # æˆ‘ä»¬ç”¨ find å‘½ä»¤åœ¨ .theos æ–‡ä»¶å¤¹é‡ŒæŸ¥æ‰¾ä»»ä½• dylibï¼Œå¹¶å¤åˆ¶åˆ°å½“å‰ç›®å½•
          find .theos -name "*.dylib" -exec cp {} ./FakeBundleID_Final.dylib \;
          
          # 3. æ‰“å°ä¸€ä¸‹å½“å‰ç›®å½•æ–‡ä»¶ï¼Œç¡®ä¿æ–‡ä»¶åœ¨è¿™ï¼ˆæ–¹ä¾¿æ’é”™ï¼‰
          ls -l
          
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: FakeBundleID_Plugin
          # ğŸŸ¢ å…³é”®ä¿®æ”¹ï¼šç›´æ¥ä¸Šä¼ æˆ‘ä»¬åˆšåˆšå¤åˆ¶å‡ºæ¥çš„è¿™ä¸ªæ–‡ä»¶ï¼Œä¸å«ä»»ä½•è·¯å¾„ï¼Œç»å¯¹èƒ½æ‰¾åˆ°
          path: FakeBundleID_Final.dylib
